# Generated by Django 4.2.7 on 2025-12-13 18:33

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('tenants', '0002_add_current_academic_year'),
        ('academics', '0002_initial'),
        ('schooladmin', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='EventInvitation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('event_name', models.CharField(max_length=200)),
                ('event_type', models.CharField(choices=[('meeting', 'Meeting'), ('parent_teacher', 'Parent-Teacher Conference'), ('workshop', 'Workshop'), ('sports_day', 'Sports Day'), ('graduation', 'Graduation'), ('other', 'Other')], max_length=50)),
                ('description', models.TextField(blank=True)),
                ('event_date', models.DateTimeField()),
                ('location', models.CharField(blank=True, max_length=200)),
                ('target_audience', models.CharField(choices=[('all_students', 'All Students'), ('all_parents', 'All Parents'), ('all_teachers', 'All Teachers'), ('all_staff', 'All Staff'), ('specific_class', 'Specific Class'), ('specific_students', 'Specific Students'), ('custom', 'Custom List')], max_length=50)),
                ('target_list', models.JSONField(default=list)),
                ('rsvp_required', models.BooleanField(default=True)),
                ('rsvp_deadline', models.DateTimeField(blank=True, null=True)),
                ('total_invited', models.IntegerField(default=0)),
                ('rsvp_yes', models.IntegerField(default=0)),
                ('rsvp_no', models.IntegerField(default=0)),
                ('rsvp_pending', models.IntegerField(default=0)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_events', to=settings.AUTH_USER_MODEL)),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='event_invitations', to='tenants.tenant')),
            ],
            options={
                'db_table': 'event_invitations',
                'ordering': ['-event_date'],
            },
        ),
        migrations.CreateModel(
            name='ReportTemplate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('name', models.CharField(max_length=200)),
                ('report_type', models.CharField(choices=[('academic', 'Academic Report'), ('attendance', 'Attendance Report'), ('financial', 'Financial Report'), ('enrollment', 'Enrollment Report'), ('staff', 'Staff Report'), ('ministry', 'Ministry Report'), ('custom', 'Custom Report')], max_length=50)),
                ('template_format', models.CharField(choices=[('pdf', 'PDF'), ('excel', 'Excel'), ('csv', 'CSV'), ('html', 'HTML')], default='pdf', max_length=20)),
                ('template_file', models.FileField(blank=True, null=True, upload_to='reports/templates/')),
                ('query_config', models.JSONField(default=dict, help_text='Query configuration for data extraction')),
                ('fields_config', models.JSONField(default=list, help_text='Fields to include in report')),
                ('filters_config', models.JSONField(default=dict, help_text='Default filters')),
                ('is_active', models.BooleanField(default=True)),
                ('is_ministry_format', models.BooleanField(default=False, help_text='Ministry-compliant format')),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='report_templates', to='tenants.tenant')),
            ],
            options={
                'db_table': 'report_templates',
                'unique_together': {('tenant', 'name')},
            },
        ),
        migrations.CreateModel(
            name='MinistryExportFormat',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('format_name', models.CharField(help_text='e.g., ZIMSEC Student Register, Ministry Attendance Report', max_length=200)),
                ('format_type', models.CharField(choices=[('student_register', 'Student Register'), ('attendance_report', 'Attendance Report'), ('examination_results', 'Examination Results'), ('staff_register', 'Staff Register'), ('financial_report', 'Financial Report'), ('custom', 'Custom Format')], max_length=50)),
                ('ministry_department', models.CharField(blank=True, help_text='e.g., Ministry of Education, ZIMSEC', max_length=100)),
                ('format_specification', models.JSONField(default=dict, help_text='Format specification (columns, mappings, etc.)')),
                ('template_file', models.FileField(blank=True, null=True, upload_to='ministry/formats/')),
                ('is_active', models.BooleanField(default=True)),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='ministry_export_formats', to='tenants.tenant')),
            ],
            options={
                'db_table': 'ministry_export_formats',
                'unique_together': {('tenant', 'format_name')},
            },
        ),
        migrations.CreateModel(
            name='MinistryExport',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('export_name', models.CharField(max_length=200)),
                ('file', models.FileField(upload_to='ministry/exports/')),
                ('file_size', models.IntegerField()),
                ('date_range_start', models.DateField(blank=True, null=True)),
                ('date_range_end', models.DateField(blank=True, null=True)),
                ('status', models.CharField(choices=[('generating', 'Generating'), ('completed', 'Completed'), ('failed', 'Failed'), ('submitted', 'Submitted to Ministry')], default='generating', max_length=20)),
                ('submitted_to_ministry', models.BooleanField(default=False)),
                ('submission_date', models.DateField(blank=True, null=True)),
                ('submission_reference', models.CharField(blank=True, max_length=100)),
                ('submission_notes', models.TextField(blank=True)),
                ('exported_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('academic_year', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='ministry_exports', to='academics.academicyear')),
                ('export_format', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='exports', to='schooladmin.ministryexportformat')),
                ('exported_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='exported_ministry_reports', to=settings.AUTH_USER_MODEL)),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='ministry_exports', to='tenants.tenant')),
                ('term', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='ministry_exports', to='academics.term')),
            ],
            options={
                'db_table': 'ministry_exports',
                'ordering': ['-exported_at'],
            },
        ),
        migrations.CreateModel(
            name='MessageTemplate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('name', models.CharField(max_length=200)),
                ('template_type', models.CharField(choices=[('sms', 'SMS'), ('email', 'Email'), ('whatsapp', 'WhatsApp'), ('announcement', 'Announcement'), ('alert', 'Alert')], max_length=50)),
                ('subject', models.CharField(blank=True, help_text='For email/announcements', max_length=200)),
                ('body', models.TextField(help_text='Template body with variables like {{student_name}}')),
                ('variables', models.JSONField(default=list, help_text='Available template variables')),
                ('is_active', models.BooleanField(default=True)),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='schooladmin_message_templates', to='tenants.tenant')),
            ],
            options={
                'db_table': 'schooladmin_message_templates',
                'unique_together': {('tenant', 'name')},
            },
        ),
        migrations.CreateModel(
            name='GeneratedReport',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('report_name', models.CharField(max_length=200)),
                ('report_type', models.CharField(choices=[('academic', 'Academic Report'), ('attendance', 'Attendance Report'), ('financial', 'Financial Report'), ('enrollment', 'Enrollment Report'), ('staff', 'Staff Report'), ('ministry', 'Ministry Report'), ('custom', 'Custom Report')], max_length=50)),
                ('format', models.CharField(choices=[('pdf', 'PDF'), ('excel', 'Excel'), ('csv', 'CSV'), ('html', 'HTML')], max_length=20)),
                ('file', models.FileField(upload_to='reports/generated/')),
                ('file_size', models.IntegerField(help_text='File size in bytes')),
                ('parameters', models.JSONField(default=dict, help_text='Parameters used to generate report')),
                ('date_range_start', models.DateField(blank=True, null=True)),
                ('date_range_end', models.DateField(blank=True, null=True)),
                ('status', models.CharField(choices=[('generating', 'Generating'), ('completed', 'Completed'), ('failed', 'Failed')], default='generating', max_length=20)),
                ('record_count', models.IntegerField(default=0)),
                ('generation_time_seconds', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('generated_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('generated_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='generated_reports', to=settings.AUTH_USER_MODEL)),
                ('template', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='generated_reports', to='schooladmin.reporttemplate')),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='generated_reports', to='tenants.tenant')),
            ],
            options={
                'db_table': 'generated_reports',
                'ordering': ['-generated_at'],
            },
        ),
        migrations.CreateModel(
            name='CommunicationCampaign',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('name', models.CharField(max_length=200)),
                ('campaign_type', models.CharField(choices=[('sms', 'SMS Campaign'), ('email', 'Email Campaign'), ('whatsapp', 'WhatsApp Broadcast'), ('announcement', 'Announcement'), ('emergency', 'Emergency Alert')], max_length=50)),
                ('target_audience', models.CharField(choices=[('all_students', 'All Students'), ('all_parents', 'All Parents'), ('all_teachers', 'All Teachers'), ('all_staff', 'All Staff'), ('specific_class', 'Specific Class'), ('specific_students', 'Specific Students'), ('custom', 'Custom List')], max_length=50)),
                ('target_list', models.JSONField(default=list, help_text='List of IDs for specific targets')),
                ('message_content', models.TextField()),
                ('scheduled_at', models.DateTimeField(blank=True, null=True)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('scheduled', 'Scheduled'), ('sending', 'Sending'), ('completed', 'Completed'), ('failed', 'Failed'), ('cancelled', 'Cancelled')], default='draft', max_length=20)),
                ('total_recipients', models.IntegerField(default=0)),
                ('sent_count', models.IntegerField(default=0)),
                ('delivered_count', models.IntegerField(default=0)),
                ('failed_count', models.IntegerField(default=0)),
                ('opened_count', models.IntegerField(default=0, help_text='For email/WhatsApp')),
                ('sent_at', models.DateTimeField(blank=True, null=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_campaigns', to=settings.AUTH_USER_MODEL)),
                ('template', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='campaigns', to='schooladmin.messagetemplate')),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='communication_campaigns', to='tenants.tenant')),
            ],
            options={
                'db_table': 'communication_campaigns',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='RSVPResponse',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('respondent_type', models.CharField(choices=[('student', 'Student'), ('parent', 'Parent/Guardian'), ('teacher', 'Teacher'), ('staff', 'Staff')], max_length=50)),
                ('respondent_id', models.IntegerField()),
                ('respondent_name', models.CharField(max_length=200)),
                ('response', models.CharField(choices=[('yes', 'Yes'), ('no', 'No'), ('maybe', 'Maybe')], max_length=10)),
                ('notes', models.TextField(blank=True)),
                ('responded_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('invitation', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='rsvp_responses', to='schooladmin.eventinvitation')),
            ],
            options={
                'db_table': 'rsvp_responses',
                'ordering': ['-responded_at'],
                'unique_together': {('invitation', 'respondent_type', 'respondent_id')},
            },
        ),
        migrations.CreateModel(
            name='CommunicationLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('channel', models.CharField(choices=[('sms', 'SMS'), ('email', 'Email'), ('whatsapp', 'WhatsApp'), ('push', 'Push Notification'), ('in_app', 'In-App Notification')], max_length=50)),
                ('recipient_type', models.CharField(choices=[('student', 'Student'), ('parent', 'Parent/Guardian'), ('teacher', 'Teacher'), ('staff', 'Staff')], max_length=50)),
                ('recipient_id', models.IntegerField(help_text='ID of the recipient (student, user, etc.)')),
                ('recipient_name', models.CharField(max_length=200)),
                ('recipient_contact', models.CharField(help_text='Phone/Email', max_length=200)),
                ('subject', models.CharField(blank=True, max_length=200)),
                ('message', models.TextField()),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('sent', 'Sent'), ('delivered', 'Delivered'), ('failed', 'Failed'), ('bounced', 'Bounced')], default='pending', max_length=20)),
                ('provider_message_id', models.CharField(blank=True, max_length=200)),
                ('provider_response', models.JSONField(blank=True, default=dict, null=True)),
                ('error_message', models.TextField(blank=True)),
                ('sent_at', models.DateTimeField(blank=True, null=True)),
                ('delivered_at', models.DateTimeField(blank=True, null=True)),
                ('campaign', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='logs', to='schooladmin.communicationcampaign')),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='communication_logs', to='tenants.tenant')),
            ],
            options={
                'db_table': 'communication_logs',
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['tenant', 'status', 'created_at'], name='communicati_tenant__445221_idx'), models.Index(fields=['campaign', 'status'], name='communicati_campaig_ff9cc0_idx')],
            },
        ),
        migrations.CreateModel(
            name='CommunicationChannel',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('channel_type', models.CharField(choices=[('sms', 'SMS'), ('email', 'Email'), ('whatsapp', 'WhatsApp'), ('push', 'Push Notification'), ('in_app', 'In-App Notification')], max_length=50)),
                ('is_enabled', models.BooleanField(default=True)),
                ('provider', models.CharField(blank=True, help_text='Provider name (e.g., Twilio, SendGrid)', max_length=100)),
                ('api_key', models.CharField(blank=True, help_text='Encrypted API key', max_length=200)),
                ('api_secret', models.CharField(blank=True, help_text='Encrypted API secret', max_length=200)),
                ('configuration', models.JSONField(default=dict, help_text='Channel-specific configuration')),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='communication_channels', to='tenants.tenant')),
            ],
            options={
                'db_table': 'communication_channels',
                'unique_together': {('tenant', 'channel_type')},
            },
        ),
        migrations.CreateModel(
            name='AnalyticsQuery',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('name', models.CharField(max_length=200)),
                ('description', models.TextField(blank=True)),
                ('query_type', models.CharField(choices=[('enrollment_trend', 'Enrollment Trend'), ('attendance_analysis', 'Attendance Analysis'), ('academic_performance', 'Academic Performance'), ('financial_analysis', 'Financial Analysis'), ('teacher_effectiveness', 'Teacher Effectiveness'), ('custom', 'Custom Query')], max_length=50)),
                ('query_config', models.JSONField(default=dict, help_text='Query configuration')),
                ('visualization_type', models.CharField(choices=[('line', 'Line Chart'), ('bar', 'Bar Chart'), ('pie', 'Pie Chart'), ('table', 'Table'), ('heatmap', 'Heatmap')], default='table', max_length=50)),
                ('is_shared', models.BooleanField(default=False, help_text='Share with other admins')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_analytics_queries', to=settings.AUTH_USER_MODEL)),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='analytics_queries', to='tenants.tenant')),
            ],
            options={
                'db_table': 'analytics_queries',
                'unique_together': {('tenant', 'name')},
            },
        ),
    ]
