# Generated by Django 4.2.7 on 2025-12-13 18:16

from decimal import Decimal
from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('fees', '0002_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('assessments', '0002_initial'),
        ('tenants', '0002_add_current_academic_year'),
        ('academics', '0002_initial'),
        ('students', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='ExamCycle',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('name', models.CharField(help_text='e.g., End of Term 1 Exams', max_length=200)),
                ('exam_type', models.CharField(choices=[('formative', 'Formative'), ('summative', 'Summative'), ('mid_term', 'Mid-Term'), ('final', 'Final')], default='summative', max_length=50)),
                ('status', models.CharField(choices=[('planning', 'Planning'), ('scheduled', 'Scheduled'), ('in_progress', 'In Progress'), ('marking', 'Marking'), ('moderation', 'Moderation'), ('approved', 'Approved'), ('locked', 'Locked'), ('published', 'Published')], default='planning', max_length=50)),
                ('start_date', models.DateField(blank=True, null=True)),
                ('end_date', models.DateField(blank=True, null=True)),
                ('moderation_required', models.BooleanField(default=True)),
                ('moderation_status', models.CharField(choices=[('pending', 'Pending'), ('in_progress', 'In Progress'), ('approved', 'Approved'), ('rejected', 'Rejected')], default='pending', max_length=50)),
                ('moderated_at', models.DateTimeField(blank=True, null=True)),
                ('is_locked', models.BooleanField(default=False)),
                ('locked_at', models.DateTimeField(blank=True, null=True)),
                ('academic_year', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='exam_cycles', to='academics.academicyear')),
                ('locked_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='locked_exam_cycles', to=settings.AUTH_USER_MODEL)),
                ('moderated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='moderated_exam_cycles', to=settings.AUTH_USER_MODEL)),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='exam_cycles', to='tenants.tenant')),
                ('term', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='exam_cycles', to='academics.term')),
            ],
            options={
                'db_table': 'exam_cycles',
                'ordering': ['-start_date'],
            },
        ),
        migrations.CreateModel(
            name='TimetableVersion',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('name', models.CharField(help_text='e.g., Main Timetable, Emergency Timetable', max_length=200)),
                ('version_number', models.IntegerField(default=1)),
                ('is_active', models.BooleanField(default=False)),
                ('is_published', models.BooleanField(default=False)),
                ('published_at', models.DateTimeField(blank=True, null=True)),
                ('generation_method', models.CharField(choices=[('manual', 'Manual'), ('ai_assisted', 'AI-Assisted'), ('auto', 'Automatic')], default='manual', max_length=50)),
                ('generation_metadata', models.JSONField(default=dict, help_text='AI generation parameters and results')),
                ('academic_year', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='timetable_versions', to='academics.academicyear')),
                ('generated_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='generated_timetables', to=settings.AUTH_USER_MODEL)),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='timetable_versions', to='tenants.tenant')),
            ],
            options={
                'db_table': 'timetable_versions',
                'ordering': ['-version_number'],
                'unique_together': {('tenant', 'academic_year', 'version_number')},
            },
        ),
        migrations.CreateModel(
            name='StudentLifecycleEvent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('event_type', models.CharField(choices=[('enrollment', 'Enrollment'), ('promotion', 'Promotion'), ('demotion', 'Demotion'), ('transfer_in', 'Transfer In'), ('transfer_out', 'Transfer Out'), ('suspension', 'Suspension'), ('withdrawal', 'Withdrawal'), ('graduation', 'Graduation'), ('alumni', 'Alumni Status')], max_length=50)),
                ('event_date', models.DateField()),
                ('reason', models.TextField(blank=True)),
                ('notes', models.TextField(blank=True)),
                ('from_class', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='lifecycle_events_from', to='academics.class')),
                ('performed_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='performed_lifecycle_events', to=settings.AUTH_USER_MODEL)),
                ('student', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lifecycle_events', to='students.student')),
                ('to_class', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='lifecycle_events_to', to='academics.class')),
            ],
            options={
                'db_table': 'student_lifecycle_events',
                'ordering': ['-event_date'],
            },
        ),
        migrations.CreateModel(
            name='StudentDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('document_type', models.CharField(choices=[('birth_certificate', 'Birth Certificate'), ('id_copy', 'ID Copy'), ('medical', 'Medical Records'), ('transfer', 'Transfer Certificate'), ('certificate', 'Certificate'), ('transcript', 'Transcript'), ('other', 'Other')], max_length=50)),
                ('title', models.CharField(max_length=200)),
                ('file', models.FileField(upload_to='students/documents/')),
                ('description', models.TextField(blank=True)),
                ('is_verified', models.BooleanField(default=False)),
                ('verified_at', models.DateTimeField(blank=True, null=True)),
                ('student', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='documents', to='students.student')),
                ('verified_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='verified_documents', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'student_documents',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='StaffRecord',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('employee_number', models.CharField(max_length=50, unique=True)),
                ('employment_type', models.CharField(choices=[('full_time', 'Full-Time'), ('part_time', 'Part-Time'), ('contract', 'Contract'), ('volunteer', 'Volunteer')], default='full_time', max_length=50)),
                ('hire_date', models.DateField()),
                ('contract_start', models.DateField(blank=True, null=True)),
                ('contract_end', models.DateField(blank=True, null=True)),
                ('contract_document', models.FileField(blank=True, null=True, upload_to='staff/contracts/')),
                ('qualifications', models.JSONField(default=list, help_text='List of qualifications')),
                ('certifications', models.JSONField(default=list, help_text='List of certifications')),
                ('department', models.CharField(blank=True, max_length=100)),
                ('position', models.CharField(blank=True, max_length=100)),
                ('annual_leave_balance', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5)),
                ('sick_leave_balance', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5)),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='staff_records', to='tenants.tenant')),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='staff_record', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'staff_records',
            },
        ),
        migrations.CreateModel(
            name='StaffAppraisal',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('appraisal_period', models.CharField(help_text='e.g., Q1 2024, Annual 2024', max_length=50)),
                ('appraisal_date', models.DateField(default=django.utils.timezone.now)),
                ('attendance_score', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('lesson_completion_score', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('student_outcomes_score', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('parent_feedback_score', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('overall_score', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('supervisor_comments', models.TextField(blank=True)),
                ('employee_comments', models.TextField(blank=True)),
                ('pd_goals', models.JSONField(default=list, help_text='Professional development goals')),
                ('pd_completed', models.JSONField(default=list, help_text='Completed professional development')),
                ('appraised_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='conducted_appraisals', to=settings.AUTH_USER_MODEL)),
                ('staff', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='appraisals', to='schooladmin.staffrecord')),
            ],
            options={
                'db_table': 'staff_appraisals',
                'ordering': ['-appraisal_date'],
            },
        ),
        migrations.CreateModel(
            name='SchoolProfile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('ministry_registration_number', models.CharField(blank=True, max_length=100)),
                ('registration_certificate', models.FileField(blank=True, null=True, upload_to='school/registration/')),
                ('accreditation_status', models.CharField(choices=[('accredited', 'Accredited'), ('provisional', 'Provisional'), ('pending', 'Pending'), ('suspended', 'Suspended')], default='pending', max_length=50)),
                ('accreditation_expiry', models.DateField(blank=True, null=True)),
                ('constitution', models.FileField(blank=True, null=True, upload_to='school/governance/')),
                ('policies', models.JSONField(default=list, help_text='List of policy documents')),
                ('logo', models.ImageField(blank=True, null=True, upload_to='school/logo/')),
                ('primary_color', models.CharField(default='#1976D2', help_text='Hex color code', max_length=7)),
                ('secondary_color', models.CharField(default='#424242', help_text='Hex color code', max_length=7)),
                ('letterhead_template', models.FileField(blank=True, null=True, upload_to='school/templates/')),
                ('principal_signature', models.ImageField(blank=True, null=True, upload_to='school/signatures/')),
                ('bursar_signature', models.ImageField(blank=True, null=True, upload_to='school/signatures/')),
                ('tenant', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='school_profile', to='tenants.tenant')),
            ],
            options={
                'db_table': 'school_profiles',
            },
        ),
        migrations.CreateModel(
            name='PostLockGradeChange',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('original_score', models.DecimalField(decimal_places=2, max_digits=5)),
                ('new_score', models.DecimalField(decimal_places=2, max_digits=5)),
                ('justification', models.TextField(help_text='Reason for change after lock')),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('approved_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_post_lock_changes', to=settings.AUTH_USER_MODEL)),
                ('grade', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='post_lock_changes', to='assessments.grade')),
            ],
            options={
                'db_table': 'post_lock_grade_changes',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='PaymentReconciliation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('reconciliation_date', models.DateField(default=django.utils.timezone.now)),
                ('expected_amount', models.DecimalField(decimal_places=2, max_digits=10)),
                ('received_amount', models.DecimalField(decimal_places=2, max_digits=10)),
                ('difference', models.DecimalField(decimal_places=2, max_digits=10)),
                ('breakdown', models.JSONField(default=dict, help_text='Breakdown by payment method')),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('reconciled', 'Reconciled'), ('discrepancy', 'Discrepancy Found')], default='pending', max_length=20)),
                ('notes', models.TextField(blank=True)),
                ('reconciled_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='reconciled_payments', to=settings.AUTH_USER_MODEL)),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='payment_reconciliations', to='tenants.tenant')),
            ],
            options={
                'db_table': 'payment_reconciliations',
                'ordering': ['-reconciliation_date'],
            },
        ),
        migrations.CreateModel(
            name='LeaveRequest',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('leave_type', models.CharField(choices=[('annual', 'Annual Leave'), ('sick', 'Sick Leave'), ('personal', 'Personal Leave'), ('maternity', 'Maternity Leave'), ('paternity', 'Paternity Leave'), ('unpaid', 'Unpaid Leave')], max_length=50)),
                ('start_date', models.DateField()),
                ('end_date', models.DateField()),
                ('days_requested', models.DecimalField(decimal_places=2, max_digits=5)),
                ('reason', models.TextField()),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('approved', 'Approved'), ('rejected', 'Rejected'), ('cancelled', 'Cancelled')], default='pending', max_length=20)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('rejection_reason', models.TextField(blank=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_leave_requests', to=settings.AUTH_USER_MODEL)),
                ('staff', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='leave_requests', to='schooladmin.staffrecord')),
            ],
            options={
                'db_table': 'leave_requests',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='GradeModeration',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('stage', models.CharField(choices=[('teacher_submitted', 'Teacher Submitted'), ('hod_review', 'HOD Review'), ('admin_approval', 'Admin Approval'), ('principal_approval', 'Principal Approval')], default='teacher_submitted', max_length=50)),
                ('original_score', models.DecimalField(decimal_places=2, max_digits=5)),
                ('moderated_score', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('moderation_reason', models.TextField(blank=True)),
                ('moderated_at', models.DateTimeField(blank=True, null=True)),
                ('is_approved', models.BooleanField(default=False)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_grades', related_query_name='approved_grade', to=settings.AUTH_USER_MODEL)),
                ('exam_cycle', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='grade_moderations', to='schooladmin.examcycle')),
                ('grade', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='moderations', to='assessments.grade')),
                ('moderated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='moderated_grades', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'grade_moderations',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='FeeStructureEnhanced',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('name', models.CharField(max_length=200)),
                ('base_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10)),
                ('variable_pricing_rules', models.JSONField(default=dict, help_text='Rules for variable pricing (e.g., by class, early bird discount)')),
                ('allow_installments', models.BooleanField(default=False)),
                ('installment_config', models.JSONField(default=dict, help_text='Installment configuration (number, frequency, etc.)')),
                ('scholarship_rules', models.JSONField(default=list, help_text='Scholarship eligibility rules')),
                ('waiver_rules', models.JSONField(default=list, help_text='Fee waiver rules')),
                ('currency', models.CharField(default='USD', help_text='ISO currency code', max_length=3)),
                ('exchange_rate', models.DecimalField(decimal_places=4, default=Decimal('1.0000'), max_digits=10)),
                ('inflation_adjustment_enabled', models.BooleanField(default=False)),
                ('inflation_rate', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Annual inflation rate %', max_digits=5)),
                ('late_payment_penalty', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Percentage', max_digits=5)),
                ('penalty_grace_period_days', models.IntegerField(default=7)),
                ('is_active', models.BooleanField(default=True)),
                ('academic_year', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='enhanced_fee_structures', to='academics.academicyear')),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='enhanced_fee_structures', to='tenants.tenant')),
            ],
            options={
                'db_table': 'fee_structures_enhanced',
                'ordering': ['-academic_year', 'name'],
            },
        ),
        migrations.CreateModel(
            name='DashboardMetrics',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('calculated_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('total_enrollment', models.IntegerField(default=0)),
                ('enrollment_by_gender', models.JSONField(default=dict)),
                ('enrollment_by_grade', models.JSONField(default=dict)),
                ('enrollment_by_stream', models.JSONField(default=dict)),
                ('total_teachers', models.IntegerField(default=0)),
                ('active_teachers', models.IntegerField(default=0)),
                ('teacher_utilization_ratio', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5)),
                ('student_teacher_ratio', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5)),
                ('attendance_today', models.IntegerField(default=0)),
                ('attendance_percentage_today', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5)),
                ('chronic_absenteeism_count', models.IntegerField(default=0)),
                ('chronic_absenteeism_risk_index', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5)),
                ('academic_performance_index', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5)),
                ('average_grade', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5)),
                ('fee_collection_today', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10)),
                ('fee_collection_term', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10)),
                ('fee_collection_year', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10)),
                ('fee_collection_vs_target', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Percentage', max_digits=5)),
                ('outstanding_fees_30_days', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10)),
                ('outstanding_fees_60_days', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10)),
                ('outstanding_fees_90_days', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10)),
                ('teachers_active_today', models.IntegerField(default=0)),
                ('parents_active_today', models.IntegerField(default=0)),
                ('students_active_today', models.IntegerField(default=0)),
                ('missing_marks_count', models.IntegerField(default=0)),
                ('late_attendance_count', models.IntegerField(default=0)),
                ('compliance_alerts', models.JSONField(default=list)),
                ('dropout_risk_count', models.IntegerField(default=0)),
                ('exam_failure_prediction', models.JSONField(default=dict)),
                ('teacher_overload_alerts', models.JSONField(default=list)),
                ('revenue_forecast', models.JSONField(default=dict)),
                ('at_risk_students', models.JSONField(default=list)),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='dashboard_metrics', to='tenants.tenant')),
            ],
            options={
                'db_table': 'dashboard_metrics',
                'ordering': ['-calculated_at'],
                'get_latest_by': 'calculated_at',
            },
        ),
        migrations.CreateModel(
            name='AttendanceOfflineSync',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('sync_date', models.DateTimeField(default=django.utils.timezone.now)),
                ('records_count', models.IntegerField(default=0)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('syncing', 'Syncing'), ('completed', 'Completed'), ('failed', 'Failed')], default='pending', max_length=20)),
                ('error_message', models.TextField(blank=True)),
                ('synced_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='synced_attendance', to=settings.AUTH_USER_MODEL)),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='offline_attendance_syncs', to='tenants.tenant')),
            ],
            options={
                'db_table': 'attendance_offline_syncs',
                'ordering': ['-sync_date'],
            },
        ),
        migrations.CreateModel(
            name='AttendanceAlert',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('alert_type', models.CharField(choices=[('chronic_absenteeism', 'Chronic Absenteeism'), ('pattern_change', 'Pattern Change'), ('unauthorized_absence', 'Unauthorized Absence'), ('late_arrival', 'Late Arrival')], max_length=50)),
                ('severity', models.CharField(choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High'), ('critical', 'Critical')], default='medium', max_length=20)),
                ('message', models.TextField()),
                ('is_sent', models.BooleanField(default=False)),
                ('sent_to', models.JSONField(default=list, help_text='List of recipients (parents, admin)')),
                ('sent_at', models.DateTimeField(blank=True, null=True)),
                ('student', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='attendance_alerts', to='students.student')),
            ],
            options={
                'db_table': 'attendance_alerts',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='AcademicConfiguration',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('curriculum_framework', models.CharField(choices=[('zimsec', 'ZIMSEC'), ('cambridge', 'Cambridge'), ('ib', 'International Baccalaureate'), ('custom', 'Custom')], default='zimsec', max_length=50)),
                ('grading_system', models.CharField(choices=[('numeric', 'Numeric (0-100)'), ('letter', 'Letter Grades (A-F)'), ('gpa', 'GPA (0-4.0)'), ('competency', 'Competency-Based')], default='numeric', max_length=50)),
                ('grading_scale', models.JSONField(default=dict, help_text="Grading scale configuration (e.g., {'A': [80, 100], 'B': [70, 79]})")),
                ('promotion_rules', models.JSONField(default=dict, help_text="Promotion criteria (e.g., {'min_average': 50, 'max_failures': 2})")),
                ('subject_weights', models.JSONField(default=dict, help_text='Subject weights for final grade calculation')),
                ('assessment_rubrics', models.JSONField(default=list, help_text='Assessment rubric templates')),
                ('report_card_approval_required', models.BooleanField(default=True)),
                ('approval_workflow', models.JSONField(default=list, help_text="Approval workflow steps (e.g., ['teacher', 'hod', 'principal'])")),
                ('tenant', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='academic_config', to='tenants.tenant')),
            ],
            options={
                'db_table': 'academic_configurations',
            },
        ),
        migrations.CreateModel(
            name='TimetableSlotEnhanced',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('has_conflicts', models.BooleanField(default=False)),
                ('conflict_details', models.JSONField(default=list, help_text='List of conflicts detected')),
                ('slot', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='enhanced_slots', to='academics.timetableslot')),
                ('timetable_version', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='slots', to='schooladmin.timetableversion')),
            ],
            options={
                'db_table': 'timetable_slots_enhanced',
                'unique_together': {('timetable_version', 'slot')},
            },
        ),
        migrations.CreateModel(
            name='AdmissionApplication',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('first_name', models.CharField(max_length=100)),
                ('last_name', models.CharField(max_length=100)),
                ('date_of_birth', models.DateField()),
                ('gender', models.CharField(choices=[('male', 'Male'), ('female', 'Female')], max_length=10)),
                ('phone', models.CharField(blank=True, max_length=20)),
                ('email', models.EmailField(blank=True, max_length=254)),
                ('address', models.TextField(blank=True)),
                ('application_number', models.CharField(max_length=50, unique=True)),
                ('application_date', models.DateField(default=django.utils.timezone.now)),
                ('stage', models.CharField(choices=[('application_received', 'Application Received'), ('shortlisted', 'Shortlisted'), ('interviewed', 'Interviewed'), ('accepted', 'Accepted'), ('enrolled', 'Enrolled'), ('waitlisted', 'Waitlisted'), ('rejected', 'Rejected')], default='application_received', max_length=50)),
                ('documents', models.JSONField(default=list, help_text='List of uploaded document URLs')),
                ('interview_date', models.DateTimeField(blank=True, null=True)),
                ('interview_notes', models.TextField(blank=True)),
                ('interview_score', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('acceptance_letter_sent', models.BooleanField(default=False)),
                ('acceptance_letter_sent_at', models.DateTimeField(blank=True, null=True)),
                ('enrollment_contract_signed', models.BooleanField(default=False)),
                ('pre_invoice_created', models.BooleanField(default=False)),
                ('notes', models.TextField(blank=True)),
                ('communication_log', models.JSONField(default=list, help_text='Log of emails/SMS sent')),
                ('academic_year', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='admission_applications', to='academics.academicyear')),
                ('applied_class', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='applications', to='academics.class')),
                ('pre_invoice', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='admission_applications', to='fees.feeinvoice')),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='admission_applications', to='tenants.tenant')),
            ],
            options={
                'db_table': 'admission_applications',
                'ordering': ['-application_date'],
                'indexes': [models.Index(fields=['tenant', 'stage'], name='admission_a_tenant__7b8cad_idx'), models.Index(fields=['academic_year', 'stage'], name='admission_a_academi_92f1aa_idx')],
            },
        ),
    ]
